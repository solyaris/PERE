<html>
<head> 
  <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
  <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
</head> 
<body>
  <div id="event"></div>	
  
  <script type='text/javascript'>
  //
  // generate a random device ID (sort of mobile phone number)
  //
  function rc(min, max) { 
    return Math.floor(Math.random() * (max - min)) + min; 
  }
  
  // 'W' for web
  var local_device_id = 'W' + '0039' + rc(1,9) + rc(0,9) + rc(0,9) + rc(0,9) + rc(0,9) + rc(0,9) + rc(0,9) + rc(0,9) + rc(0,9)  

  // 
  // hardcode the channel name
  //
  var channel = 'CHANNEL_1'

  //
  // GET HTTP SSE MESSAGES STREAM
  // http://www.html5rocks.com/en/tutorials/eventsource/basics/
  //
 
  // specify the device id as parameter in HTTP GET
  // http://stackoverflow.com/questions/25254870/event-source-polyfill-send-parameters 
  var parameters = '?device=' + local_device_id

  var es = new EventSource('/feed/' + channel + parameters);

  es.onmessage = function(e) { 

  	//if (e.origin != 'http://example.com') {
    //  alert('Origin was not http://example.com');
    //return;

  	$('#event').append(e.data + "\n"); 
  	
  	console.log(e.data); 

    // feedback to server with a HTTP POST
    $.post( '/feedback/' + channel, { id: e.lastEventId, device: local_device_id, status: "ok" } );
  };
  </script>
</body>
</html>